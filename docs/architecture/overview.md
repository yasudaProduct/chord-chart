# システムアーキテクチャ概要

ChordBook のシステム全体構成を説明します。

## システム構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                         クライアント                              │
│                     (ブラウザ / モバイル)                          │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                          Vercel                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                   Next.js 14 (App Router)                 │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐  │  │
│  │  │   Pages     │ │ Components  │ │  State (Zustand)    │  │  │
│  │  │  (app/)     │ │             │ │  - authStore        │  │  │
│  │  │             │ │             │ │  - editorStore      │  │  │
│  │  └─────────────┘ └─────────────┘ └─────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                                │
                    ┌───────────┴───────────┐
                    ▼                       ▼
┌───────────────────────────┐   ┌───────────────────────────────┐
│        Supabase           │   │          Railway              │
│  ┌─────────────────────┐  │   │  ┌─────────────────────────┐  │
│  │   Supabase Auth     │  │   │  │  ASP.NET Core 8 Web API │  │
│  │  (認証・認可)        │  │   │  │                         │  │
│  └─────────────────────┘  │   │  │  ┌───────────────────┐  │  │
│                           │   │  │  │    Controllers    │  │  │
│  ┌─────────────────────┐  │   │  │  └─────────┬─────────┘  │  │
│  │    PostgreSQL       │  │   │  │            │            │  │
│  │   (データベース)      │◄─┼───┤  ┌─────────▼─────────┐  │  │
│  └─────────────────────┘  │   │  │  │   Application     │  │  │
│                           │   │  │  │   (MediatR)       │  │  │
└───────────────────────────┘   │  │  └─────────┬─────────┘  │  │
                                │  │            │            │  │
                                │  │  ┌─────────▼─────────┐  │  │
                                │  │  │  Infrastructure   │  │  │
                                │  │  │  (EF Core)        │  │  │
                                │  │  └───────────────────┘  │  │
                                │  └─────────────────────────┘  │
                                └───────────────────────────────┘
```

## 技術スタック

### フロントエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| Next.js | 14 | React フレームワーク (App Router) |
| React | 18.3 | UI ライブラリ |
| TypeScript | 5.4 | 型安全な JavaScript |
| Tailwind CSS | 3.4 | ユーティリティファースト CSS |
| Zustand | 最新 | 状態管理 |
| shadcn/ui | 最新 | UI コンポーネント |

### バックエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| ASP.NET Core | 8.0 | Web API フレームワーク |
| Entity Framework Core | 8.0 | ORM |
| MediatR | 最新 | CQRS パターン実装 |
| FluentValidation | 最新 | バリデーション |

### インフラ

| サービス | 用途 |
|----------|------|
| Vercel | フロントエンドホスティング |
| Railway | バックエンドホスティング |
| Supabase | 認証 + PostgreSQL データベース |
| GitHub Actions | CI/CD |

## データフロー

### 1. 認証フロー

```
ユーザー → Supabase Auth → JWT トークン取得
         ↓
フロントエンド → Authorization ヘッダーに JWT を付与
         ↓
バックエンド API → JWT 検証 → リクエスト処理
```

### 2. データ取得フロー

```
フロントエンド → API リクエスト (fetch/axios)
         ↓
バックエンド API
  └→ Controller → MediatR Handler → Repository → PostgreSQL
         ↓
レスポンス (JSON) → フロントエンド → 状態更新 (Zustand) → UI 更新
```

### 3. データ更新フロー

```
ユーザー操作 → Zustand 状態更新 (楽観的更新)
         ↓
API リクエスト → バックエンド処理 → DB 更新
         ↓
成功: 確定 / 失敗: ロールバック
```

## ディレクトリ構成

```
chord-book/
├── frontend/                 # Next.js フロントエンド
│   └── src/
│       ├── app/              # App Router ページ
│       ├── lib/              # ユーティリティ
│       ├── stores/           # Zustand ストア
│       └── types/            # TypeScript 型定義
│
├── backend/                  # ASP.NET Core バックエンド
│   └── src/
│       ├── ChordBook.Api/          # Web API 層
│       ├── ChordBook.Application/  # アプリケーション層
│       ├── ChordBook.Domain/       # ドメイン層
│       └── ChordBook.Infrastructure/ # インフラ層
│
├── docs/                     # ドキュメント
└── .github/                  # GitHub Actions
```

## 関連ドキュメント

- [バックエンドアーキテクチャ](./backend.md) - Clean Architecture の詳細
- [フロントエンドアーキテクチャ](./frontend.md) - Next.js 構成の詳細
- [データベース設計](../database/er-diagram.md) - ER図とテーブル定義
